const ATOMIC_STDIN_FILLED = 0;
const ATOMIC_STDIN_CONSUMED = 1;
const ATOMIC_COUNT = 2;
const STDIN_BITS = 10;
const STDIN_COUNT = (1 << STDIN_BITS);
const STDIN_MASK = STDIN_COUNT - 1;
function exec_base64_wasm(data, wasm) {
    var memory;
    const { atomic_sab, stdin_sab } = data;
    const atomic = new Int32Array(atomic_sab);
    const stdin = new Uint8Array(stdin_sab);
    const ERRNO_SUCCESS = 0;
    const ERRNO_BADF = 8;
    const ERRNO_NOTCAPABLE = 76;
    function read_u8(ptr, offset) { return new DataView(memory.buffer).getUint8(ptr + offset); }
    function read_u16(ptr, offset) { return new DataView(memory.buffer).getUint16(ptr + offset, true); }
    function read_u32(ptr, offset) { return new DataView(memory.buffer).getUint32(ptr + offset, true); }
    function read_usize(ptr, offset) { return read_u32(ptr, offset); }
    function read_ptr(ptr, offset) { return read_usize(ptr, offset); }
    function write_u8(ptr, offset, value) { new DataView(memory.buffer).setUint8(ptr + offset, value); }
    function write_u16(ptr, offset, value) { new DataView(memory.buffer).setUint16(ptr + offset, value, true); }
    function write_u32(ptr, offset, value) { new DataView(memory.buffer).setUint32(ptr + offset, value, true); }
    function write_usize(ptr, offset, value) { write_u32(ptr, offset, value); }
    function write_ptr(ptr, offset, value) { write_usize(ptr, offset, value); }
    function slice(ptr, start, end) { return new DataView(memory.buffer, ptr + start, end - start); }
    function nyi() {
        return ERRNO_NOTCAPABLE;
    }
    function args_get() { return nyi(); }
    function args_sizes_get() { return nyi(); }
    function environ_get() { return nyi(); }
    function environ_sizes_get() { return nyi(); }
    function clock_res_get() { return nyi(); }
    function clock_time_get() { return nyi(); }
    function fd_advise() { return nyi(); }
    function fd_allocate() { return nyi(); }
    function fd_close() { return nyi(); }
    function fd_datasync() { return nyi(); }
    function fd_fdstat_get() { return nyi(); }
    function fd_fdstat_set_flags() { return nyi(); }
    function fd_fdstat_set_rights() { return nyi(); }
    function fd_filestat_get() { return nyi(); }
    function fd_filestat_set_size() { return nyi(); }
    function fd_filestat_set_times() { return nyi(); }
    function fd_pread() { return nyi(); }
    function fd_prestat_get() { return nyi(); }
    function fd_prestat_dir_name() { return nyi(); }
    function fd_pwrite() { return nyi(); }
    function fd_read(fd, iovec_array_ptr, iovec_array_len, nread_ptr) {
        var nread = 0;
        var errno = ERRNO_SUCCESS;
        for (var iovec_idx = 0; iovec_idx < iovec_array_len; ++iovec_idx) {
            var buf_ptr = read_ptr(iovec_array_ptr, 8 * iovec_idx + 0);
            var buf_len = read_usize(iovec_array_ptr, 8 * iovec_idx + 4);
            if (buf_len <= 0) {
                continue;
            }
            switch (fd) {
                case 0:
                    for (;;) {
                        var consumed = Atomics.load(atomic, ATOMIC_STDIN_CONSUMED);
                        while (Atomics.wait(atomic, ATOMIC_STDIN_FILLED, consumed) !== "ok") { }
                        var filled = Atomics.load(atomic, ATOMIC_STDIN_FILLED);
                        var available = (filled - consumed) | 0;
                        console.assert(available > 0);
                        var n = Math.min(available, buf_len);
                        for (var i = 0; i < n; ++i) {
                            var b = stdin[(i + consumed) & STDIN_MASK];
                            work2dom.post({ kind: "console", text: new TextDecoder().decode(new Uint8Array([b])) });
                            write_u8(buf_ptr, i, b);
                        }
                        Atomics.store(atomic, ATOMIC_STDIN_CONSUMED, (consumed + n) | 0);
                        nread += n;
                        break;
                    }
                    break;
                default:
                    errno = ERRNO_BADF;
                    break;
            }
        }
        write_usize(nread_ptr, 0, nread);
        return errno;
    }
    function fd_readdir() { return nyi(); }
    function fd_renumber() { return nyi(); }
    function fd_seek() { return nyi(); }
    function fd_sync() { return nyi(); }
    function fd_tell() { return nyi(); }
    function fd_write(fd, ciovec_array_ptr, ciovec_array_len, nwritten_ptr) {
        var nwritten = 0;
        var errno = ERRNO_SUCCESS;
        var text = "";
        for (var ciovec_idx = 0; ciovec_idx < ciovec_array_len; ++ciovec_idx) {
            var buf_ptr = read_ptr(ciovec_array_ptr, 8 * ciovec_idx + 0);
            var buf_len = read_usize(ciovec_array_ptr, 8 * ciovec_idx + 4);
            switch (fd) {
                case 1:
                case 2:
                    text += new TextDecoder().decode(slice(buf_ptr, 0, buf_len));
                    nwritten += buf_len;
                    break;
                default:
                    errno = ERRNO_BADF;
                    break;
            }
        }
        if (text !== "") {
            work2dom.post({ kind: "console", text });
        }
        write_usize(nwritten_ptr, 0, nwritten);
        return errno;
    }
    function path_create_directory() { return nyi(); }
    function path_filestats_get() { return nyi(); }
    function path_filestat_set_times() { return nyi(); }
    function path_link() { return nyi(); }
    function path_open() { return nyi(); }
    function path_readlink() { return nyi(); }
    function path_remove_directory() { return nyi(); }
    function path_rename() { return nyi(); }
    function path_symlink() { return nyi(); }
    function path_unlink_file() { return nyi(); }
    function poll_oneoff() { return nyi(); }
    function proc_exit(code) {
        work2dom.post({ kind: "proc_exit", code });
        throw "exit";
    }
    function proc_raise() { return nyi(); }
    function sched_yield() { return nyi(); }
    function random_get() { return nyi(); }
    function sock_recv() { return nyi(); }
    function sock_send() { return nyi(); }
    function sock_shutdown() { return nyi(); }
    const imports = {
        wasi_snapshot_preview1: {
            args_get,
            args_sizes_get,
            environ_get,
            environ_sizes_get,
            clock_res_get,
            clock_time_get,
            fd_advise,
            fd_allocate,
            fd_close,
            fd_datasync,
            fd_fdstat_get,
            fd_fdstat_set_flags,
            fd_fdstat_set_rights,
            fd_filestat_get,
            fd_filestat_set_size,
            fd_filestat_set_times,
            fd_pread,
            fd_prestat_get,
            fd_prestat_dir_name,
            fd_pwrite,
            fd_read,
            fd_readdir,
            fd_renumber,
            fd_seek,
            fd_sync,
            fd_tell,
            fd_write,
            path_create_directory,
            path_filestats_get,
            path_filestat_set_times,
            path_link,
            path_open,
            path_readlink,
            path_remove_directory,
            path_rename,
            path_symlink,
            path_unlink_file,
            poll_oneoff,
            proc_exit,
            proc_raise,
            sched_yield,
            random_get,
            sock_recv,
            sock_send,
            sock_shutdown,
        },
    };
    const binary = atob(wasm);
    const typedarray = new Uint8Array(binary.length);
    for (var i = 0; i < binary.length; ++i) {
        typedarray[i] = binary.charCodeAt(i);
    }
    WebAssembly.compile(typedarray).then(function (m) {
        if (false) {
            WebAssembly.Module.imports(m).forEach(function (imp) {
                console.log("import", imp);
            });
            WebAssembly.Module.exports(m).forEach(function (exp) {
                console.log("export", exp);
            });
        }
        return WebAssembly.instantiate(m, imports);
    }).then(function (m) {
        memory = m.exports.memory;
        try {
            m.exports.main();
            proc_exit(0);
        }
        catch (e) {
            if (e !== "exit") {
                console.error(e);
                debugger;
                throw e;
            }
        }
        finally {
            self.close();
        }
    });
}
var main_dom_worker;
function main_dom() {
    const con = requireElementById("console");
    const cursor = requireElementById("cursor");
    const atomic_sab = new SharedArrayBuffer(4 * ATOMIC_COUNT);
    const atomic = new Int32Array(atomic_sab);
    const stdin_sab = new SharedArrayBuffer(STDIN_COUNT);
    const stdin = new Uint8Array(stdin_sab);
    const blob = new Blob(Array.prototype.map.call(document.querySelectorAll('script:not([data-js-worker=\'false\'])'), function (oScript) { return oScript.textContent; }), { type: 'text/javascript' });
    main_dom_worker = new Worker(window.URL.createObjectURL(blob));
    main_dom_worker.onmessage = function (e) {
        switch (e.data.kind) {
            case "console":
                con.insertBefore(document.createTextNode(e.data.text), cursor);
                break;
            case "proc_exit":
                var exit = document.createElement("span");
                exit.textContent = `\nprocess exited with code ${e.data.code}`;
                exit.style.color = e.data.code == 0 ? "#888" : "#C44";
                con.insertBefore(exit, cursor);
                con.removeChild(cursor);
                break;
            default:
                console.error("unexpected event kind", e.data.kind);
                debugger;
                break;
        }
    };
    dom2work.post({
        kind: "init",
        atomic_sab,
        stdin_sab,
    });
    var stdin_buffer = [];
    document.addEventListener("keypress", function (e) {
        var text = e.char || String.fromCharCode(e.charCode);
        if (text === "\r") {
            text = "\n";
        }
        var chars = new TextEncoder().encode(text);
        for (var i = 0; i < chars.length; ++i) {
            stdin_buffer.push(chars[i]);
        }
    });
    setInterval(function () {
        if (stdin_buffer.length === 0)
            return;
        var filled = Atomics.load(atomic, ATOMIC_STDIN_FILLED);
        var consumed = Atomics.load(atomic, ATOMIC_STDIN_CONSUMED);
        var available = STDIN_COUNT - ((filled - consumed) | 0);
        var n = Math.min(available, stdin_buffer.length);
        for (var i = 0; i < n; ++i) {
            stdin[(i + filled) & STDIN_MASK] = stdin_buffer[i];
        }
        stdin_buffer.splice(0, n);
        filled = (filled + n) | 0;
        Atomics.store(atomic, ATOMIC_STDIN_FILLED, filled);
        Atomics.notify(atomic, ATOMIC_STDIN_FILLED, +Infinity);
    }, 0);
}
function requireElementById(id) {
    let el = document.getElementById(id);
    if (!el) {
        throw `no such element in document: #${id}`;
    }
    return el;
}
function main_worker() {
    self.onmessage = function (e) {
        switch (e.data.kind) {
            case "init":
                exec_base64_wasm(e.data, "{BASE64_WASM32}");
                break;
            default:
                console.error("unexpected event kind", e.data.kind);
                debugger;
                break;
        }
    };
}
var dom2work;
(function (dom2work) {
    function post(data) {
        main_dom_worker.postMessage(data);
    }
    dom2work.post = post;
})(dom2work || (dom2work = {}));
var work2dom;
(function (work2dom) {
    function post(message) {
        self.postMessage(message);
    }
    work2dom.post = post;
})(work2dom || (work2dom = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc2NyaXB0L2NvbnN0YW50cy50cyIsIi4uL3NjcmlwdC9leGVjLXdhc20udHMiLCIuLi9zY3JpcHQvbWFpbi1kb20udHMiLCIuLi9zY3JpcHQvbWFpbi13b3JrZXIudHMiLCIuLi9zY3JpcHQvbWVzc2FnZXMvZG9tMndvcmsudHMiLCIuLi9zY3JpcHQvbWVzc2FnZXMvd29yazJkb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxtQkFBbUIsR0FBSyxDQUFDLENBQUM7QUFDaEMsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLENBQUM7QUFDaEMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFDO0FBRXZCLE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztBQUN0QixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsQ0FBQztBQUN0QyxNQUFNLFVBQVUsR0FBRyxXQUFXLEdBQUMsQ0FBQyxDQUFDO0FDTmpDLFNBQVMsZ0JBQWdCLENBQUMsSUFBUyxFQUFFLElBQVk7SUFDN0MsSUFBSSxNQUEyQixDQUFDO0lBVWhDLE1BQU0sRUFBQyxVQUFVLEVBQUUsU0FBUyxFQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ3JDLE1BQU0sTUFBTSxHQUFNLElBQUksVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sS0FBSyxHQUFPLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBUTVDLE1BQU0sYUFBYSxHQUFjLENBQUMsQ0FBQztJQUNuQyxNQUFNLFVBQVUsR0FBaUIsQ0FBQyxDQUFDO0lBQ25DLE1BQU0sZ0JBQWdCLEdBQVcsRUFBRSxDQUFDO0lBRXBDLFNBQVMsT0FBTyxDQUFJLEdBQVEsRUFBRSxNQUFjLElBQWMsT0FBTyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFFLEdBQUcsR0FBRyxNQUFNLENBQWEsQ0FBQyxDQUFDLENBQUM7SUFDbkksU0FBUyxRQUFRLENBQUcsR0FBUSxFQUFFLE1BQWMsSUFBYyxPQUFPLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLE1BQU0sRUFBRSxJQUFJLENBQVEsQ0FBQyxDQUFDLENBQUM7SUFDcEksU0FBUyxRQUFRLENBQUcsR0FBUSxFQUFFLE1BQWMsSUFBYyxPQUFPLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLE1BQU0sRUFBRSxJQUFJLENBQVEsQ0FBQyxDQUFDLENBQUM7SUFDcEksU0FBUyxVQUFVLENBQUMsR0FBUSxFQUFFLE1BQWMsSUFBYyxPQUFPLFFBQVEsQ0FBRyxHQUFHLEVBQUUsTUFBTSxDQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ2xHLFNBQVMsUUFBUSxDQUFHLEdBQVEsRUFBRSxNQUFjLElBQWMsT0FBTyxVQUFVLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBUSxDQUFDLENBQUMsQ0FBQztJQUVsRyxTQUFTLFFBQVEsQ0FBTyxHQUFRLEVBQUUsTUFBYyxFQUFFLEtBQVMsSUFBUyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFFLEdBQUcsR0FBRyxNQUFNLEVBQUUsS0FBSyxDQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3ZJLFNBQVMsU0FBUyxDQUFNLEdBQVEsRUFBRSxNQUFjLEVBQUUsS0FBVSxJQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZJLFNBQVMsU0FBUyxDQUFNLEdBQVEsRUFBRSxNQUFjLEVBQUUsS0FBVSxJQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLE1BQU0sRUFBRSxLQUFL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ZSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRmUsYUFBSSxPQUVuQixDQUFBO0FBQ0wsQ0FBQyxFQXBCUyxRQUFRLEtBQVIsUUFBUSxRQW9CakI7QUNwQkQsSUFBVSxRQUFRLENBMEJqQjtBQTFCRCxXQUFVLFFBQVE7SUFxQmQsU0FBZ0IsSUFBSSxDQUFDLE9BQWE7UUFHN0IsSUFBWSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBSmUsYUFBSSxPQUluQixDQUFBO0FBQ0wsQ0FBQyxFQTFCUyxRQUFRLEtBQVIsUUFBUSxRQTBCakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBBVE9NSUNfU1RESU5fRklMTEVEICAgPSAwO1xyXG5jb25zdCBBVE9NSUNfU1RESU5fQ09OU1VNRUQgPSAxO1xyXG5jb25zdCBBVE9NSUNfQ09VTlQgPSAyO1xyXG5cclxuY29uc3QgU1RESU5fQklUUyA9IDEwO1xyXG5jb25zdCBTVERJTl9DT1VOVCA9ICgxIDw8IFNURElOX0JJVFMpO1xyXG5jb25zdCBTVERJTl9NQVNLID0gU1RESU5fQ09VTlQtMTtcclxuIiwiZnVuY3Rpb24gZXhlY19iYXNlNjRfd2FzbShkYXRhOiBhbnksIHdhc206IHN0cmluZykge1xyXG4gICAgdmFyIG1lbW9yeSA6IFdlYkFzc2VtYmx5Lk1lbW9yeTtcclxuXHJcbiAgICB0eXBlIEZkICAgICA9IG51bWJlciAmIHsgX25vdF9yZWFsOiBcImZkXCI7IH1cclxuICAgIHR5cGUgRXJybm8gID0gbnVtYmVyICYgeyBfbm90X3JlYWw6IFwiZXJybm9cIjsgfVxyXG4gICAgdHlwZSBwdHIgICAgPSBudW1iZXIgJiB7IF9ub3RfcmVhbDogXCJwdHJcIjsgfVxyXG4gICAgdHlwZSB1OCAgICAgPSBudW1iZXIgJiB7IF9ub3RfcmVhbDogXCJ1OFwiOyB9XHJcbiAgICB0eXBlIHUxNiAgICA9IG51bWJlciAmIHsgX25vdF9yZWFsOiBcInUxNlwiOyB9XHJcbiAgICB0eXBlIHUzMiAgICA9IG51bWJlciAmIHsgX25vdF9yZWFsOiBcInUzMlwiOyB9XHJcbiAgICB0eXBlIHVzaXplICA9IG51bWJlciAmIHsgX25vdF9yZWFsOiBcInVzaXplXCI7IH1cclxuXHJcbiAgICBjb25zdCB7YXRvbWljX3NhYiwgc3RkaW5fc2FifSA9IGRhdGE7XHJcbiAgICBjb25zdCBhdG9taWMgICAgPSBuZXcgSW50MzJBcnJheShhdG9taWNfc2FiKTtcclxuICAgIGNvbnN0IHN0ZGluICAgICA9IG5ldyBVaW50OEFycmF5KHN0ZGluX3NhYik7XHJcblxyXG4gICAgLy8gUmVmZXJlbmNlczpcclxuICAgIC8vIGh0dHBzOi8vZG9jcy5ycy93YXNpLXR5cGVzLzAuMS41L3NyYy93YXNpX3R5cGVzL2xpYi5ycy5odG1sXHJcbiAgICAvLyBodHRwczovL2RvY3MucnMvd2FzaS8wLjEwLjIrd2FzaS1zbmFwc2hvdC1wcmV2aWV3MS9zcmMvd2FzaS9saWJfZ2VuZXJhdGVkLnJzLmh0bWxcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9XZWJBc3NlbWJseS9XQVNJL2Jsb2IvbWFpbi9waGFzZXMvc25hcHNob3QvZG9jcy5tZFxyXG5cclxuICAgIC8vIGh0dHBzOi8vZG9jcy5ycy93YXNpLzAuMTAuMit3YXNpLXNuYXBzaG90LXByZXZpZXcxL3NyYy93YXNpL2xpYl9nZW5lcmF0ZWQucnMuaHRtbCMyN1xyXG4gICAgY29uc3QgRVJSTk9fU1VDQ0VTUyAgICAgPSA8RXJybm8+MDtcclxuICAgIGNvbnN0IEVSUk5PX0JBREYgICAgICAgID0gPEVycm5vPjg7XHJcbiAgICBjb25zdCBFUlJOT19OT1RDQVBBQkxFICA9IDxFcnJubz43NjtcclxuXHJcbiAgICBmdW5jdGlvbiByZWFkX3U4KCAgIHB0cjogcHRyLCBvZmZzZXQ6IG51bWJlcik6IHU4ICAgICAgIHsgcmV0dXJuIG5ldyBEYXRhVmlldyhtZW1vcnkuYnVmZmVyKS5nZXRVaW50OCggcHRyICsgb2Zmc2V0ICAgICAgKSBhcyB1ODsgfVxyXG4gICAgZnVuY3Rpb24gcmVhZF91MTYoICBwdHI6IHB0ciwgb2Zmc2V0OiBudW1iZXIpOiB1MTYgICAgICB7IHJldHVybiBuZXcgRGF0YVZpZXcobWVtb3J5LmJ1ZmZlcikuZ2V0VWludDE2KHB0ciArIG9mZnNldCwgdHJ1ZSkgYXMgdTE2OyB9XHJcbiAgICBmdW5jdGlvbiByZWFkX3UzMiggIHB0cjogcHRyLCBvZmZzZXQ6IG51bWJlcik6IHUzMiAgICAgIHsgcmV0dXJuIG5ldyBEYXRhVmlldyhtZW1vcnkuYnVmZmVyKS5nZXRVaW50MzIocHRyICsgb2Zmc2V0LCB0cnVlKSBhcyB1MzI7IH1cclxuICAgIGZ1bmN0aW9uIHJlYWRfdXNpemUocHRyOiBwdHIsIG9mZnNldDogbnVtYmVyKTogdXNpemUgICAgeyByZXR1cm4gcmVhZF91MzIoICBwdHIsIG9mZnNldCkgYXMgYW55OyB9XHJcbiAgICBmdW5jdGlvbiByZWFkX3B0ciggIHB0cjogcHRyLCBvZmZzZXQ6IG51bWJlcik6IHB0ciAgICAgIHsgcmV0dXJuIHJlYWRfdXNpemUocHRyLCBvZmZzZXQpIGFzIGFueTsgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHdyaXRlX3U4KCAgICAgIHB0cjogcHRyLCBvZmZzZXQ6IG51bWJlciwgdmFsdWU6IHU4ICAgICApIHsgbmV3IERhdGFWaWV3KG1lbW9yeS5idWZmZXIpLnNldFVpbnQ4KCBwdHIgKyBvZmZzZXQsIHZhbHVlICAgICAgKTsgfVxyXG4gICAgZnVuY3Rpb24gd3JpdGVfdTE2KCAgICAgcHRyOiBwdHIsIG9mZnNldDogbnVtYmVyLCB2YWx1ZTogdTE2ICAgICkgeyBuZXcgRGF0YVZpZXcobWVtb3J5LmJ1ZmZlcikuc2V0VWludDE2KHB0ciArIG9mZnNldCwgdmFsdWUsIHRydWUpOyB9XHJcbiAgICBmdW5jdGlvbiB3cml0ZV91MzIoICAgICBwdHI6IHB0ciwgb2Zmc2V0OiBudW1iZXIsIHZhbHVlOiB1MzIgICAgKSB7IG5ldyBEYXRhVmlldyhtZW1vcnkuYnVmZmVyKS5zZXRVaW50MzIocHRyICsgb2Zmc2V0LCB2YWx1ZSwgdHJ1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHdyaXRlX3VzaXplKCAgIHB0cjogcHRyLCBvZmZzZXQ6IG51bWJlciwgdmFsdWU6IHVzaXplICApIHsgd3JpdGVfdTMyKCAgcHRyLCBvZmZzZXQsIHZhbHVlIGFzIGFueSk7IH1cclxuICAgIGZ1bmN0aW9uIHdyaXRlX3B0ciggICAgIHB0cjogcHRyLCBvZmZzZXQ6IG51bWJlciwgdmFsdWU6IHB0ciAgICApIHsgd3JpdGVfdXNpemUocHRyLCBvZmZzZXQsIHZhbHVlIGFzIGFueSk7IH1cclxuXHJcbiAgICBmdW5jdGlvbiBzbGljZShwdHI6IHB0ciwgc3RhcnQ6IHVzaXplLCBlbmQ6IHVzaXplKTogRGF0YVZpZXcgeyByZXR1cm4gbmV3IERhdGFWaWV3KG1lbW9yeS5idWZmZXIsIHB0citzdGFydCwgZW5kLXN0YXJ0KTsgfVxyXG5cclxuICAgIGZ1bmN0aW9uIG55aSgpOiBFcnJubyB7XHJcbiAgICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgICAgICByZXR1cm4gRVJSTk9fTk9UQ0FQQUJMRTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhcmdzX2dldCAgICAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGFyZ3Nfc2l6ZXNfZ2V0ICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZW52aXJvbl9nZXQgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBlbnZpcm9uX3NpemVzX2dldCAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGNsb2NrX3Jlc19nZXQgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gY2xvY2tfdGltZV9nZXQgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBmZF9hZHZpc2UgICAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGZkX2FsbG9jYXRlICAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZmRfY2xvc2UgICAgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBmZF9kYXRhc3luYyAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGZkX2Zkc3RhdF9nZXQgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZmRfZmRzdGF0X3NldF9mbGFncyAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBmZF9mZHN0YXRfc2V0X3JpZ2h0cyAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGZkX2ZpbGVzdGF0X2dldCAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZmRfZmlsZXN0YXRfc2V0X3NpemUgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBmZF9maWxlc3RhdF9zZXRfdGltZXMgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGZkX3ByZWFkICAgICAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZmRfcHJlc3RhdF9nZXQgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBmZF9wcmVzdGF0X2Rpcl9uYW1lICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGZkX3B3cml0ZSAgICAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGZkX3JlYWQoZmQ6IEZkLCBpb3ZlY19hcnJheV9wdHI6IHB0ciwgaW92ZWNfYXJyYXlfbGVuOiB1c2l6ZSwgbnJlYWRfcHRyOiBwdHIpOiBFcnJubyB7XHJcbiAgICAgICAgLy8gaHR0cHM6Ly9kb2NzLnJzL3dhc2kvMC4xMC4yK3dhc2ktc25hcHNob3QtcHJldmlldzEvc3JjL3dhc2kvbGliX2dlbmVyYXRlZC5ycy5odG1sIzE3NTRcclxuXHJcbiAgICAgICAgdmFyIG5yZWFkID0gMDtcclxuICAgICAgICB2YXIgZXJybm8gPSBFUlJOT19TVUNDRVNTO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpb3ZlY19pZHggPSAwOyBpb3ZlY19pZHggPCBpb3ZlY19hcnJheV9sZW47ICsraW92ZWNfaWR4KSB7XHJcbiAgICAgICAgICAgIHZhciBidWZfcHRyID0gcmVhZF9wdHIoaW92ZWNfYXJyYXlfcHRyLCA4ICogaW92ZWNfaWR4ICsgMCk7XHJcbiAgICAgICAgICAgIHZhciBidWZfbGVuID0gcmVhZF91c2l6ZShpb3ZlY19hcnJheV9wdHIsIDggKiBpb3ZlY19pZHggKyA0KTtcclxuICAgICAgICAgICAgaWYgKGJ1Zl9sZW4gPD0gMCkgeyBjb250aW51ZTsgfVxyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChmZCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiAvLyBzdGRpblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoOzspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnN1bWVkICAgID0gQXRvbWljcy5sb2FkKGF0b21pYywgQVRPTUlDX1NURElOX0NPTlNVTUVEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKEF0b21pY3Mud2FpdChhdG9taWMsIEFUT01JQ19TVERJTl9GSUxMRUQsIGNvbnN1bWVkKSAhPT0gXCJva1wiKSB7fVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsbGVkICAgICAgPSBBdG9taWNzLmxvYWQoYXRvbWljLCBBVE9NSUNfU1RESU5fRklMTEVEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF2YWlsYWJsZSAgID0gKGZpbGxlZC1jb25zdW1lZCl8MDsgLy8gYXZhaWxhYmxlICp0byByZWFkKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmFzc2VydChhdmFpbGFibGUgPiAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBNYXRoLm1pbihhdmFpbGFibGUsIGJ1Zl9sZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPG47ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBzdGRpblsoaStjb25zdW1lZCkmU1RESU5fTUFTS10gYXMgdTg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrMmRvbS5wb3N0KHsga2luZDogXCJjb25zb2xlXCIsIHRleHQ6IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShuZXcgVWludDhBcnJheShbYl0pKSB9KTsgLy8gWFhYOiBsb2NhbCBlY2hvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZV91OChidWZfcHRyLCBpLCBiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBBdG9taWNzLnN0b3JlKGF0b21pYywgQVRPTUlDX1NURElOX0NPTlNVTUVELCAoY29uc3VtZWQrbil8MCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBucmVhZCArPSBuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGVycm5vID0gRVJSTk9fQkFERjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgd3JpdGVfdXNpemUobnJlYWRfcHRyLCAwLCBucmVhZCBhcyB1c2l6ZSk7XHJcbiAgICAgICAgcmV0dXJuIGVycm5vO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGZkX3JlYWRkaXIgICAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZmRfcmVudW1iZXIgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBmZF9zZWVrICAgICAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIGZkX3N5bmMgICAgICAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gZmRfdGVsbCAgICAgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcblxyXG4gICAgZnVuY3Rpb24gZmRfd3JpdGUoZmQ6IEZkLCBjaW92ZWNfYXJyYXlfcHRyOiBwdHIsIGNpb3ZlY19hcnJheV9sZW46IHVzaXplLCBud3JpdHRlbl9wdHI6IHB0cik6IEVycm5vIHtcclxuICAgICAgICAvLyBodHRwczovL2RvY3MucnMvd2FzaS8wLjEwLjIrd2FzaS1zbmFwc2hvdC1wcmV2aWV3MS9zcmMvd2FzaS9saWJfZ2VuZXJhdGVkLnJzLmh0bWwjMTc5NlxyXG4gICAgICAgIC8vIGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvd2FzaS5odG1sXHJcblxyXG4gICAgICAgIHZhciBud3JpdHRlbiA9IDA7XHJcbiAgICAgICAgdmFyIGVycm5vID0gRVJSTk9fU1VDQ0VTUztcclxuXHJcbiAgICAgICAgdmFyIHRleHQgPSBcIlwiO1xyXG4gICAgICAgIGZvciAodmFyIGNpb3ZlY19pZHggPSAwOyBjaW92ZWNfaWR4IDwgY2lvdmVjX2FycmF5X2xlbjsgKytjaW92ZWNfaWR4KSB7XHJcbiAgICAgICAgICAgIHZhciBidWZfcHRyID0gcmVhZF9wdHIoY2lvdmVjX2FycmF5X3B0ciwgOCAqIGNpb3ZlY19pZHggKyAwKTtcclxuICAgICAgICAgICAgdmFyIGJ1Zl9sZW4gPSByZWFkX3VzaXplKGNpb3ZlY19hcnJheV9wdHIsIDggKiBjaW92ZWNfaWR4ICsgNCk7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKGZkKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6IC8vIHN0ZG91dFxyXG4gICAgICAgICAgICAgICAgY2FzZSAyOiAvLyBzdGRlcnJcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShzbGljZShidWZfcHRyLCAwIGFzIHVzaXplLCBidWZfbGVuKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbndyaXR0ZW4gKz0gYnVmX2xlbjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZXJybm8gPSBFUlJOT19CQURGO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGV4dCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICB3b3JrMmRvbS5wb3N0KHsga2luZDogXCJjb25zb2xlXCIsIHRleHQgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB3cml0ZV91c2l6ZShud3JpdHRlbl9wdHIsIDAsIG53cml0dGVuIGFzIHVzaXplKTtcclxuICAgICAgICByZXR1cm4gZXJybm87XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcGF0aF9jcmVhdGVfZGlyZWN0b3J5ICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBwYXRoX2ZpbGVzdGF0c19nZXQgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIHBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gcGF0aF9saW5rICAgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBwYXRoX29wZW4gICAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIHBhdGhfcmVhZGxpbmsgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gcGF0aF9yZW1vdmVfZGlyZWN0b3J5ICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBwYXRoX3JlbmFtZSAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIHBhdGhfc3ltbGluayAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gcGF0aF91bmxpbmtfZmlsZSAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBwb2xsX29uZW9mZiAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuXHJcbiAgICBmdW5jdGlvbiBwcm9jX2V4aXQoY29kZTogbnVtYmVyKTogbmV2ZXIge1xyXG4gICAgICAgIC8vIGh0dHBzOi8vZG9jcy5ycy93YXNpLzAuMTAuMit3YXNpLXNuYXBzaG90LXByZXZpZXcxL3NyYy93YXNpL2xpYl9nZW5lcmF0ZWQucnMuaHRtbCMxOTAxXHJcbiAgICAgICAgd29yazJkb20ucG9zdCh7IGtpbmQ6IFwicHJvY19leGl0XCIsIGNvZGUgfSk7XHJcbiAgICAgICAgdGhyb3cgXCJleGl0XCI7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcHJvY19yYWlzZSAgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBzY2hlZF95aWVsZCAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIHJhbmRvbV9nZXQgICAgICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG4gICAgZnVuY3Rpb24gc29ja19yZWN2ICAgICAgICAgICAgICAgICAgKCk6IEVycm5vIHsgcmV0dXJuIG55aSgpOyB9XHJcbiAgICBmdW5jdGlvbiBzb2NrX3NlbmQgICAgICAgICAgICAgICAgICAoKTogRXJybm8geyByZXR1cm4gbnlpKCk7IH1cclxuICAgIGZ1bmN0aW9uIHNvY2tfc2h1dGRvd24gICAgICAgICAgICAgICgpOiBFcnJubyB7IHJldHVybiBueWkoKTsgfVxyXG5cclxuICAgIGNvbnN0IGltcG9ydHMgPSB7XHJcbiAgICAgICAgd2FzaV9zbmFwc2hvdF9wcmV2aWV3MToge1xyXG4gICAgICAgICAgICBhcmdzX2dldCxcclxuICAgICAgICAgICAgYXJnc19zaXplc19nZXQsXHJcbiAgICAgICAgICAgIGVudmlyb25fZ2V0LFxyXG4gICAgICAgICAgICBlbnZpcm9uX3NpemVzX2dldCxcclxuICAgICAgICAgICAgY2xvY2tfcmVzX2dldCxcclxuICAgICAgICAgICAgY2xvY2tfdGltZV9nZXQsXHJcbiAgICAgICAgICAgIGZkX2FkdmlzZSxcclxuICAgICAgICAgICAgZmRfYWxsb2NhdGUsXHJcbiAgICAgICAgICAgIGZkX2Nsb3NlLFxyXG4gICAgICAgICAgICBmZF9kYXRhc3luYyxcclxuICAgICAgICAgICAgZmRfZmRzdGF0X2dldCxcclxuICAgICAgICAgICAgZmRfZmRzdGF0X3NldF9mbGFncyxcclxuICAgICAgICAgICAgZmRfZmRzdGF0X3NldF9yaWdodHMsXHJcbiAgICAgICAgICAgIGZkX2ZpbGVzdGF0X2dldCxcclxuICAgICAgICAgICAgZmRfZmlsZXN0YXRfc2V0X3NpemUsXHJcbiAgICAgICAgICAgIGZkX2ZpbGVzdGF0X3NldF90aW1lcyxcclxuICAgICAgICAgICAgZmRfcHJlYWQsXHJcbiAgICAgICAgICAgIGZkX3ByZXN0YXRfZ2V0LFxyXG4gICAgICAgICAgICBmZF9wcmVzdGF0X2Rpcl9uYW1lLFxyXG4gICAgICAgICAgICBmZF9wd3JpdGUsXHJcbiAgICAgICAgICAgIGZkX3JlYWQsXHJcbiAgICAgICAgICAgIGZkX3JlYWRkaXIsXHJcbiAgICAgICAgICAgIGZkX3JlbnVtYmVyLFxyXG4gICAgICAgICAgICBmZF9zZWVrLFxyXG4gICAgICAgICAgICBmZF9zeW5jLFxyXG4gICAgICAgICAgICBmZF90ZWxsLFxyXG4gICAgICAgICAgICBmZF93cml0ZSxcclxuICAgICAgICAgICAgcGF0aF9jcmVhdGVfZGlyZWN0b3J5LFxyXG4gICAgICAgICAgICBwYXRoX2ZpbGVzdGF0c19nZXQsXHJcbiAgICAgICAgICAgIHBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzLFxyXG4gICAgICAgICAgICBwYXRoX2xpbmssXHJcbiAgICAgICAgICAgIHBhdGhfb3BlbixcclxuICAgICAgICAgICAgcGF0aF9yZWFkbGluayxcclxuICAgICAgICAgICAgcGF0aF9yZW1vdmVfZGlyZWN0b3J5LFxyXG4gICAgICAgICAgICBwYXRoX3JlbmFtZSxcclxuICAgICAgICAgICAgcGF0aF9zeW1saW5rLFxyXG4gICAgICAgICAgICBwYXRoX3VubGlua19maWxlLFxyXG4gICAgICAgICAgICBwb2xsX29uZW9mZixcclxuICAgICAgICAgICAgcHJvY19leGl0LFxyXG4gICAgICAgICAgICBwcm9jX3JhaXNlLFxyXG4gICAgICAgICAgICBzY2hlZF95aWVsZCxcclxuICAgICAgICAgICAgcmFuZG9tX2dldCxcclxuICAgICAgICAgICAgc29ja19yZWN2LFxyXG4gICAgICAgICAgICBzb2NrX3NlbmQsXHJcbiAgICAgICAgICAgIHNvY2tfc2h1dGRvd24sXHJcbiAgICAgICAgfSxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYmluYXJ5ID0gYXRvYih3YXNtKTtcclxuICAgIGNvbnN0IHR5cGVkYXJyYXkgPSBuZXcgVWludDhBcnJheShiaW5hcnkubGVuZ3RoKTtcclxuICAgIGZvciAodmFyIGk9MDsgaTxiaW5hcnkubGVuZ3RoOyArK2kpIHsgdHlwZWRhcnJheVtpXSA9IGJpbmFyeS5jaGFyQ29kZUF0KGkpOyB9XHJcblxyXG4gICAgV2ViQXNzZW1ibHkuY29tcGlsZSh0eXBlZGFycmF5KS50aGVuKGZ1bmN0aW9uIChtKSB7XHJcbiAgICAgICAgaWYgKGZhbHNlKSB7XHJcbiAgICAgICAgICAgIFdlYkFzc2VtYmx5Lk1vZHVsZS5pbXBvcnRzKG0pLmZvckVhY2goZnVuY3Rpb24gKGltcCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJpbXBvcnRcIiwgaW1wKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFdlYkFzc2VtYmx5Lk1vZHVsZS5leHBvcnRzKG0pLmZvckVhY2goZnVuY3Rpb24gKGV4cCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJleHBvcnRcIiwgZXhwKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShtLCBpbXBvcnRzKTtcclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKG0pIHtcclxuICAgICAgICBtZW1vcnkgPSA8YW55Pm0uZXhwb3J0cy5tZW1vcnk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgKG0uZXhwb3J0cy5tYWluIGFzIGFueSkoKTtcclxuICAgICAgICAgICAgcHJvY19leGl0KDApO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUgIT09IFwiZXhpdFwiKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgc2VsZi5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbiIsInZhciBtYWluX2RvbV93b3JrZXIgOiBXb3JrZXI7XHJcbmZ1bmN0aW9uIG1haW5fZG9tKCkge1xyXG4gICAgY29uc3QgY29uICAgICAgID0gcmVxdWlyZUVsZW1lbnRCeUlkKFwiY29uc29sZVwiKTtcclxuICAgIGNvbnN0IGN1cnNvciAgICA9IHJlcXVpcmVFbGVtZW50QnlJZChcImN1cnNvclwiKTtcclxuXHJcbiAgICBjb25zdCBhdG9taWNfc2FiICAgID0gbmV3IFNoYXJlZEFycmF5QnVmZmVyKDQgKiBBVE9NSUNfQ09VTlQpO1xyXG4gICAgY29uc3QgYXRvbWljICAgICAgICA9IG5ldyBJbnQzMkFycmF5KGF0b21pY19zYWIpO1xyXG4gICAgY29uc3Qgc3RkaW5fc2FiICAgICA9IG5ldyBTaGFyZWRBcnJheUJ1ZmZlcihTVERJTl9DT1VOVCk7XHJcbiAgICBjb25zdCBzdGRpbiAgICAgICAgID0gbmV3IFVpbnQ4QXJyYXkoc3RkaW5fc2FiKTtcclxuXHJcbiAgICAvLyBzcGF3biB3ZWIgd29ya2VyXHJcbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoPEJsb2JQYXJ0W10+QXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdDpub3QoW2RhdGEtanMtd29ya2VyPVxcJ2ZhbHNlXFwnXSknKSwgZnVuY3Rpb24gKG9TY3JpcHQpIHsgcmV0dXJuIG9TY3JpcHQudGV4dENvbnRlbnQ7IH0pLHt0eXBlOiAndGV4dC9qYXZhc2NyaXB0J30pO1xyXG4gICAgbWFpbl9kb21fd29ya2VyID0gbmV3IFdvcmtlcih3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7XHJcbiAgICBtYWluX2RvbV93b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24oZTogd29yazJkb20uRXZlbnQpIHtcclxuICAgICAgICBzd2l0Y2ggKGUuZGF0YS5raW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJjb25zb2xlXCI6XHJcbiAgICAgICAgICAgICAgICBjb24uaW5zZXJ0QmVmb3JlKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGUuZGF0YS50ZXh0KSwgY3Vyc29yKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwicHJvY19leGl0XCI6XHJcbiAgICAgICAgICAgICAgICB2YXIgZXhpdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgICAgICAgICAgZXhpdC50ZXh0Q29udGVudCA9IGBcXG5wcm9jZXNzIGV4aXRlZCB3aXRoIGNvZGUgJHtlLmRhdGEuY29kZX1gO1xyXG4gICAgICAgICAgICAgICAgZXhpdC5zdHlsZS5jb2xvciA9IGUuZGF0YS5jb2RlID09IDAgPyBcIiM4ODhcIiA6IFwiI0M0NFwiO1xyXG4gICAgICAgICAgICAgICAgY29uLmluc2VydEJlZm9yZShleGl0LCBjdXJzb3IpO1xyXG4gICAgICAgICAgICAgICAgY29uLnJlbW92ZUNoaWxkKGN1cnNvcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJ1bmV4cGVjdGVkIGV2ZW50IGtpbmRcIiwgZS5kYXRhLmtpbmQpO1xyXG4gICAgICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZG9tMndvcmsucG9zdCh7XHJcbiAgICAgICAga2luZDogXCJpbml0XCIsXHJcbiAgICAgICAgYXRvbWljX3NhYixcclxuICAgICAgICBzdGRpbl9zYWIsXHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgc3RkaW5fYnVmZmVyIDogbnVtYmVyW10gPSBbXTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlwcmVzc1wiLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgdmFyIHRleHQgPSBlLmNoYXIgfHwgU3RyaW5nLmZyb21DaGFyQ29kZShlLmNoYXJDb2RlKTtcclxuICAgICAgICBpZiAodGV4dCA9PT0gXCJcXHJcIikgeyB0ZXh0ID0gXCJcXG5cIjsgfVxyXG4gICAgICAgIHZhciBjaGFycyA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh0ZXh0KTtcclxuICAgICAgICBmb3IgKHZhciBpPTA7IGk8Y2hhcnMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgc3RkaW5fYnVmZmVyLnB1c2goY2hhcnNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgaWYgKHN0ZGluX2J1ZmZlci5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAgICAgdmFyIGZpbGxlZCAgICAgID0gQXRvbWljcy5sb2FkKGF0b21pYywgQVRPTUlDX1NURElOX0ZJTExFRCk7XHJcbiAgICAgICAgdmFyIGNvbnN1bWVkICAgID0gQXRvbWljcy5sb2FkKGF0b21pYywgQVRPTUlDX1NURElOX0NPTlNVTUVEKTtcclxuICAgICAgICB2YXIgYXZhaWxhYmxlICAgPSBTVERJTl9DT1VOVCAtICgoZmlsbGVkLWNvbnN1bWVkKXwwKTsgLy8gYXZhaWxhYmxlICp0byB3cml0ZSpcclxuXHJcbiAgICAgICAgdmFyIG4gPSBNYXRoLm1pbihhdmFpbGFibGUsIHN0ZGluX2J1ZmZlci5sZW5ndGgpO1xyXG4gICAgICAgIGZvciAodmFyIGk9MDsgaTxuOyArK2kpIHtcclxuICAgICAgICAgICAgc3RkaW5bKGkrZmlsbGVkKSZTVERJTl9NQVNLXSA9IHN0ZGluX2J1ZmZlcltpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RkaW5fYnVmZmVyLnNwbGljZSgwLCBuKTtcclxuICAgICAgICBmaWxsZWQgPSAoZmlsbGVkK24pfDA7XHJcbiAgICAgICAgQXRvbWljcy5zdG9yZShhdG9taWMsIEFUT01JQ19TVERJTl9GSUxMRUQsIGZpbGxlZCk7XHJcbiAgICAgICAgQXRvbWljcy5ub3RpZnkoYXRvbWljLCBBVE9NSUNfU1RESU5fRklMTEVELCArSW5maW5pdHkpO1xyXG4gICAgfSwgMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlcXVpcmVFbGVtZW50QnlJZChpZDogc3RyaW5nKTogSFRNTEVsZW1lbnQge1xyXG4gICAgbGV0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xyXG4gICAgaWYgKCFlbCkgeyB0aHJvdyBgbm8gc3VjaCBlbGVtZW50IGluIGRvY3VtZW50OiAjJHtpZH1gOyB9XHJcbiAgICByZXR1cm4gZWw7XHJcbn1cclxuIiwiZnVuY3Rpb24gbWFpbl93b3JrZXIoKSB7XHJcbiAgICBzZWxmLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGU6IGRvbTJ3b3JrLkV2ZW50KSB7XHJcbiAgICAgICAgc3dpdGNoIChlLmRhdGEua2luZCkge1xyXG4gICAgICAgICAgICBjYXNlIFwiaW5pdFwiOlxyXG4gICAgICAgICAgICAgICAgZXhlY19iYXNlNjRfd2FzbShlLmRhdGEsIFwie0JBU0U2NF9XQVNNMzJ9XCIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwidW5leHBlY3RlZCBldmVudCBraW5kXCIsIGUuZGF0YS5raW5kKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG4iLCJuYW1lc3BhY2UgZG9tMndvcmsge1xyXG4gICAgaW50ZXJmYWNlIEluaXQge1xyXG4gICAgICAgIGtpbmQ6IFwiaW5pdFwiO1xyXG4gICAgICAgIGF0b21pY19zYWI6IFNoYXJlZEFycmF5QnVmZmVyLFxyXG4gICAgICAgIHN0ZGluX3NhYjogIFNoYXJlZEFycmF5QnVmZmVyLFxyXG4gICAgfVxyXG5cclxuICAgIGludGVyZmFjZSBPdGhlciB7XHJcbiAgICAgICAga2luZDogXCJfb3RoZXJcIjtcclxuICAgIH1cclxuXHJcbiAgICB0eXBlIERhdGEgPSBJbml0IHwgT3RoZXI7XHJcblxyXG4gICAgZXhwb3J0IGludGVyZmFjZSBFdmVudCBleHRlbmRzIE1lc3NhZ2VFdmVudCB7XHJcbiAgICAgICAgcmVhZG9ubHkgZGF0YTogRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gcG9zdChkYXRhOiBEYXRhKSB7XHJcbiAgICAgICAgbWFpbl9kb21fd29ya2VyLnBvc3RNZXNzYWdlKGRhdGEpO1xyXG4gICAgfVxyXG59XHJcbiIsIm5hbWVzcGFjZSB3b3JrMmRvbSB7XHJcbiAgICBpbnRlcmZhY2UgQ29uc29sZSB7XHJcbiAgICAgICAga2luZDogICBcImNvbnNvbGVcIjtcclxuICAgICAgICB0ZXh0OiAgIHN0cmluZztcclxuICAgIH1cclxuXHJcbiAgICBpbnRlcmZhY2UgUHJvY0V4aXQge1xyXG4gICAgICAgIGtpbmQ6ICAgXCJwcm9jX2V4aXRcIjtcclxuICAgICAgICBjb2RlOiAgIG51bWJlcjtcclxuICAgIH1cclxuXHJcbiAgICBpbnRlcmZhY2UgT3RoZXIge1xyXG4gICAgICAgIGtpbmQ6ICAgXCJfb3RoZXJcIjtcclxuICAgIH1cclxuXHJcbiAgICB0eXBlIERhdGEgPSBDb25zb2xlIHwgUHJvY0V4aXQgfCBPdGhlcjtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIEV2ZW50IGV4dGVuZHMgTWVzc2FnZUV2ZW50IHtcclxuICAgICAgICByZWFkb25seSBkYXRhOiBEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBwb3N0KG1lc3NhZ2U6IERhdGEpIHtcclxuICAgICAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRGVkaWNhdGVkV29ya2VyR2xvYmFsU2NvcGUvcG9zdE1lc3NhZ2Ugbm90XHJcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dpbmRvdy9wb3N0TWVzc2FnZVxyXG4gICAgICAgIChzZWxmIGFzIGFueSkucG9zdE1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICB9XHJcbn1cclxuIl19